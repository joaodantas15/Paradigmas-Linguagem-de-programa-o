<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enquanto PRO - Hub de Compiladores</title>
    <!-- React e Babel para rodar JSX no navegador -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Fira+Code:wght@400;500&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
        }
        .font-mono {
            font-family: 'Fira Code', monospace;
        }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #334155; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- Ícones Simples (SVG Inline para garantir funcionamento offline/standalone) ---
        const Icon = ({ name, size = 18, className = "" }) => {
            // Placeholder para ícones Lucide que serão injetados ou desenhados
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const UPDATED_GRAMMAR = `grammar Enquanto;

programa : seqComando;

// Tarefa 4: Semicolon como finalizador
seqComando: (comando ';')+ ;

comando: IDs ':=' expressoes                                     # atribuicao    // Tarefa 9: Atribuição Paralela
       | 'skip'                                                  # skip
       | 'se' booleano 'entao' comando 
         ('senaose' booleano 'entao' comando)* ('senao' comando)? # se            // Tarefa 7: senaose
       | 'enquanto' booleano 'faca' comando                      # enquanto
       | 'para' ID 'de' expressao 'ate' expressao 'faca' comando # para          // Tarefa 5: para..ate
       | 'repita' expressao 'vezes' comando                      # repita        // Tarefa 6: repita x vezes
       | 'escolha' expressao 
         (expressao ':' comando)* ('_' ':' comando)?             # escolha       // Tarefa 8: escolha (switch)
       | 'exiba' (TEXTO | expressao)                             # exiba         // Tarefa 10: exiba texto/num
       | '{' seqComando '}'                                      # bloco
       ;

IDs : ID (',' ID)*;
expressoes : expressao (',' expressao)*;

expressao: INT                                                   # inteiro
         | 'leia'                                                # leia
         | ID                                                    # id
         | expressao '^' expressao                               # opBin         // Tarefa 1: Exponenciação
         | expressao ('*' | '/') expressao                       # opBin         // Tarefa 1: Divisão
         | expressao ('+' | '-') expressao                       # opBin
         | '(' expressao ')'                                     # expPar
         ;

booleano: BOOLEANO                                               # bool
        | expressao ('=' | '<=' | '<' | '>' | '>=' | '<>') expressao # opRel     // Tarefa 3: Relacionais
        | 'nao' booleano                                         # naoLogico
        | booleano 'e' booleano                                  # eLogico
        | booleano ('ou' | 'xor') booleano                       # ouXorLogico   // Tarefa 2: ou/xor
        | '(' booleano ')'                                       # boolPar
        ;`;

        const TASK_DETAILS = {
            1: {
                title: "Operadores Aritméticos (/ e ^)",
                explanation: "Implementamos a divisão inteira e a exponenciação. No TypeScript, a exponenciação é resolvida via Math.pow() ou o operador **.",
                code: `// Implementação no Interpreter (TS)\nvisitOpBin(ctx: OpBinContext): number {\n  const left = this.visit(ctx.expressao(0));\n  const right = this.visit(ctx.expressao(1));\n  const op = ctx.getChild(1).getText();\n\n  switch(op) {\n    case '/': return Math.floor(left / right); // Divisão inteira\n    case '^': return Math.pow(left, right);    // Exponenciação\n    default: return super.visitOpBin(ctx);\n  }\n}`
            },
            2: {
                title: "Lógica Booleana (ou e xor)",
                explanation: "Adicionamos operadores de disjunção inclusiva (ou) e exclusiva (xor). O XOR é simulado comparando se os valores são diferentes.",
                code: `visitOuXorLogico(ctx: OuXorLogicoContext): boolean {\n  const left = this.visit(ctx.booleano(0));\n  const right = this.visit(ctx.booleano(1));\n  const op = ctx.getChild(1).getText();\n\n  if (op === 'ou') return left || right;\n  if (op === 'xor') return left !== right; // Lógica de XOR\n  return false;\n}`
            },
            3: {
                title: "Relações de Comparação",
                explanation: "Expansão dos operadores relacionais para suportar todas as condições matemáticas básicas entre inteiros.",
                code: `visitOpRel(ctx: OpRelContext): boolean {\n  const v1 = this.visit(ctx.expressao(0));\n  const v2 = this.visit(ctx.expressao(1));\n  const op = ctx.getChild(1).getText();\n\n  switch(op) {\n    case '<': return v1 < v2;\n    case '>': return v1 > v2;\n    case '>=': return v1 >= v2;\n    case '<>': return v1 !== v2;\n    default: return v1 === v2;\n  }\n}`
            },
            4: {
                title: "Finalizador de Comando (;)",
                explanation: "Mudança na gramática para que o ponto e vírgula finalize o comando em vez de apenas separar elementos de uma lista.",
                code: `// Mudança na regra da Gramática ANTLR:\nseqComando: (comando ';')+ ;\n\n// Isso garante que todo comando encerre obrigatoriamente com ';'`
            },
            5: {
                title: "Comando Para (For-loop)",
                explanation: "Estrutura de repetição clássica. O interpretador inicializa a variável e itera até o limite definido.",
                code: `visitPara(ctx: ParaContext) {\n  const id = ctx.ID().getText();\n  const start = this.visit(ctx.expressao(0));\n  const end = this.visit(ctx.expressao(1));\n\n  for (let i = start; i <= end; i++) {\n    this.memory[id] = i;\n    this.visit(ctx.comando());\n  }\n}`
            },
            6: {
                title: "Comando Repita (Repeat-times)",
                explanation: "Açúcar sintático para executar um bloco N vezes sem precisar declarar uma variável de controle no código fonte.",
                code: `visitRepita(ctx: RepitaContext) {\n  const vezes = this.visit(ctx.expressao());\n  for (let i = 0; i < vezes; i++) {\n    this.visit(ctx.comando());\n  }\n}`
            },
            7: {
                title: "Condicional Senaose (Else-If)",
                explanation: "Permite múltiplas verificações condicionais em cascata antes do bloco final 'senao'.",
                code: `visitSe(ctx: SeContext) {\n  const condicaoSe = this.visit(ctx.booleano(0));\n  if (condicaoSe) {\n    return this.visit(ctx.comando(0));\n  }\n  for (let i = 1; i < ctx.booleano().length; i++) {\n    if (this.visit(ctx.booleano(i))) {\n      return this.visit(ctx.comando(i));\n    }\n  }\n  if (ctx.senao()) return this.visit(ctx.comando_final());\n}`
            },
            8: {
                title: "Comando Escolha (Switch)",
                explanation: "Avaliação de uma expressão contra múltiplos casos literais, incluindo suporte a um caso padrão (_).",
                code: `visitEscolha(ctx: EscolhaContext) {\n  const valor = this.visit(ctx.expressao(0));\n  let matched = false;\n  for (let i = 1; i < ctx.expressao().length; i++) {\n    if (valor === this.visit(ctx.expressao(i))) {\n      this.visit(ctx.comando(i-1));\n      matched = true; break;\n    }\n  }\n  if (!matched && ctx.defaultCase()) this.visit(ctx.comando_default());\n}`
            },
            9: {
                title: "Atribuição Paralela",
                explanation: "Permite atribuir múltiplos valores a múltiplas variáveis simultaneamente. Essencial para 'swaps' sem variável temporária.",
                code: `visitAtribuicao(ctx: AtribuicaoContext) {\n  const ids = ctx.IDs().ID().map(id => id.getText());\n  const valores = ctx.expressoes().expressao().map(exp => this.visit(exp));\n  ids.forEach((id, index) => {\n    this.memory[id] = valores[index];\n  });\n}`
            },
            10: {
                title: "Exiba Polimórfico",
                explanation: "O comando exiba agora detecta se o argumento é um literal de texto ou uma expressão numérica.",
                code: `visitExiba(ctx: ExibaContext) {\n  if (ctx.TEXTO()) {\n    console.log(ctx.TEXTO().getText().replace(/"/g, ''));\n  } else {\n    const val = this.visit(ctx.expressao());\n    console.log(val.toString());\n  }\n}`
            }
        };

        const App = () => {
            const [activeTask, setActiveTask] = useState(1);
            const [executionResult, setExecutionResult] = useState([]);
            const [viewMode, setViewMode] = useState('ide');

            React.useEffect(() => {
                lucide.createIcons();
            }, [activeTask, viewMode]);

            const handleRun = () => {
                const demoLogs = {
                    1: ["Iniciando Operações Matemáticas...", "Entrada: 10 / 2 = 5", "Entrada: 2 ^ 3 = 8", "Sucesso."],
                    2: ["Testando Lógica Booleana...", "v = verdadeiro, f = falso", "v ou f -> verdadeiro", "v xor v -> falso", "v xor f -> verdadeiro"],
                    3: ["Validando Relacionais...", "5 < 10: verdadeiro", "10 <> 10: falso", "8 >= 8: verdadeiro"],
                    5: ["Iniciando Loop Para...", "i = 1", "i = 2", "i = 3", "i = 4", "i = 5", "Loop finalizado."],
                    6: ["Repetindo 3 vezes...", "Execução 1: Ola", "Execução 2: Ola", "Execução 3: Ola"],
                    7: ["Testando Condicionais...", "Nota 4 detectada.", "Caindo no 'senaose' (Nota >= 3)", "Exibindo: Recuperação"],
                    8: ["Escolha x = 2", "Match no caso '2'", "Exibindo: dois"],
                    9: ["Atribuição Paralela: a, b := 10, 20", "Swap: a, b := b, a", "Resultado: a=20, b=10"],
                    10: ["Exiba Polimórfico...", "String: 'Ola Mundo'", "Expressão (50*2): 100"]
                };
                setExecutionResult(demoLogs[activeTask] || []);
            };

            return (
                <div className="min-h-screen p-4 md:p-8 selection:bg-cyan-500/30">
                    <div className="fixed inset-0 overflow-hidden pointer-events-none -z-10">
                        <div className="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-cyan-900/10 blur-[120px] rounded-full"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-indigo-900/10 blur-[120px] rounded-full"></div>
                    </div>

                    <div className="max-w-7xl mx-auto relative">
                        <header className="flex flex-col md:flex-row justify-between items-center mb-10 gap-6 border-b border-slate-800 pb-8">
                            <div className="flex items-center gap-4">
                                <div className="p-3 bg-gradient-to-br from-cyan-500 to-indigo-600 rounded-2xl shadow-lg shadow-cyan-500/20 text-white">
                                    <Icon name="cpu" size={32} />
                                </div>
                                <div>
                                    <h1 className="text-3xl font-black text-white tracking-tight italic uppercase">Enquanto PRO</h1>
                                    <p className="text-slate-500 font-mono text-sm uppercase tracking-widest">Hub de Implementação de Compiladores</p>
                                </div>
                            </div>
                            
                            <div className="flex bg-slate-900 p-1.5 rounded-xl border border-slate-800">
                                <button onClick={() => setViewMode('ide')} className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${viewMode === 'ide' ? 'bg-slate-800 text-cyan-400' : 'text-slate-500'}`}>Simulador</button>
                                <button onClick={() => setViewMode('grammar')} className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${viewMode === 'grammar' ? 'bg-slate-800 text-cyan-400' : 'text-slate-500'}`}>Gramática G4</button>
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            <aside className="lg:col-span-3 space-y-2">
                                <div className="flex items-center gap-2 px-2 mb-4">
                                    <Icon name="layers" size={16} className="text-cyan-500" />
                                    <span className="text-xs font-bold text-slate-500 uppercase tracking-tighter">Funcionalidades</span>
                                </div>
                                {Object.keys(TASK_DETAILS).map((id) => (
                                    <button key={id} onClick={() => setActiveTask(Number(id))} className={`w-full text-left p-4 rounded-xl transition-all border relative overflow-hidden ${activeTask === Number(id) ? 'bg-cyan-500/10 border-cyan-500/50 text-white' : 'bg-transparent border-slate-800/50 text-slate-500 hover:border-slate-700'}`}>
                                        <div className="flex justify-between items-center relative z-10">
                                            <span className="text-sm font-bold">Tarefa {id}</span>
                                            <Icon name="chevron-right" size={14} className={activeTask === Number(id) ? 'text-cyan-400' : 'text-slate-800'} />
                                        </div>
                                        {activeTask === Number(id) && <div className="absolute left-0 top-0 bottom-0 w-1 bg-cyan-500"></div>}
                                    </button>
                                ))}
                            </aside>

                            <main className="lg:col-span-9 space-y-8">
                                {viewMode === 'grammar' ? (
                                    <div className="bg-slate-950 rounded-2xl border border-slate-800 overflow-hidden shadow-2xl">
                                        <div className="bg-slate-900 px-6 py-4 border-b border-slate-800 flex justify-between">
                                            <span className="font-mono text-sm text-cyan-500">Enquanto.g4</span>
                                            <Icon name="file-code" className="text-slate-600" />
                                        </div>
                                        <pre className="p-8 text-sm font-mono text-slate-400 overflow-auto h-[500px] scrollbar-thin"><code>{UPDATED_GRAMMAR}</code></pre>
                                    </div>
                                ) : (
                                    <div className="space-y-8">
                                        <div className="bg-slate-900/50 p-8 rounded-3xl border border-slate-800/50 backdrop-blur-sm flex flex-col md:flex-row justify-between items-start gap-6">
                                            <div>
                                                <h2 className="text-3xl font-bold text-white mb-3">{TASK_DETAILS[activeTask].title}</h2>
                                                <p className="text-slate-400 leading-relaxed max-w-xl">{TASK_DETAILS[activeTask].explanation}</p>
                                            </div>
                                            <button onClick={handleRun} className="flex items-center gap-3 px-8 py-4 rounded-2xl bg-cyan-600 hover:bg-cyan-500 text-white font-black transition-all shadow-xl shadow-cyan-900/20 active:scale-95">
                                                <Icon name="play" fill="currentColor" /> EXECUTAR
                                            </button>
                                        </div>

                                        <div className="grid grid-cols-1 xl:grid-cols-2 gap-8">
                                            <div className="bg-black rounded-3xl border border-slate-800 overflow-hidden flex flex-col min-h-[350px]">
                                                <div className="bg-slate-900/80 px-4 py-3 border-b border-slate-800 flex justify-between text-slate-500 text-[10px] font-mono tracking-widest">
                                                    <div className="flex gap-2"><div className="w-2.5 h-2.5 rounded-full bg-slate-700"></div><div className="w-2.5 h-2.5 rounded-full bg-slate-700"></div></div>
                                                    <span>SAÍDA_INTERPRETADOR</span>
                                                </div>
                                                <div className="p-6 font-mono text-sm space-y-3 flex-1 overflow-auto scrollbar-thin">
                                                    {executionResult.length > 0 ? executionResult.map((line, i) => (
                                                        <div key={i} className="flex gap-4 text-green-400"><span className="text-slate-800 select-none w-4">{i+1}</span><span>&gt; {line}</span></div>
                                                    )) : <div className="text-slate-700 italic">Aguardando execução...</div>}
                                                </div>
                                            </div>
                                            <div className="bg-slate-950 rounded-3xl border border-slate-800 overflow-hidden flex flex-col min-h-[350px]">
                                                <div className="bg-slate-900 px-4 py-3 border-b border-slate-800 text-cyan-500 text-[10px] font-mono tracking-widest uppercase">IMPLEMENTACAO_LOGICA.TS</div>
                                                <pre className="p-6 text-[13px] font-mono text-slate-300 overflow-auto scrollbar-thin"><code>{TASK_DETAILS[activeTask].code}</code></pre>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </main>
                        </div>
                        <footer className="mt-16 pt-8 border-t border-slate-900 flex justify-between text-[10px] font-mono text-slate-600 uppercase tracking-widest">
                            <span>TypeScript 5.0 | ANTLRv4 | React 18</span>
                            <span>Sistema Operacional ✔</span>
                        </footer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>